<app-bubbles></app-bubbles>
<app-visualizer></app-visualizer>

<app-playlist-drawer [isOpen]="isDrawerOpen()" (close)="isDrawerOpen.set(false)"></app-playlist-drawer>

<!-- Update Notification Pulse -->
<div *ngIf="updateAvailable()" class="fixed top-4 right-4 z-50 animate-bounce">
  <button (click)="reloadApp()"
    class="bg-aurora-purple text-white px-4 py-2 rounded-full shadow-lg border border-white/20 hover:bg-aurora-purple/80 transition-colors flex items-center gap-2">
    <i class="fas fa-sync-alt animate-spin"></i>
    <span>New Version Available!</span>
  </button>
</div>

<div class="h-screen w-full flex items-center justify-center p-8 perspective-1000">
  <div class="max-w-6xl w-full grid grid-cols-1 md:grid-cols-2 gap-12 items-center">

    <!-- Left: Album Art Section -->
    <div class="flex flex-col items-center relative group perspective-1000">
      <!-- Disk / Art -->
      <div
        class="relative w-[300px] h-[300px] md:w-[450px] md:h-[450px] transition-transform duration-700 ease-out preserve-3d group-hover:rotate-y-12">

        <!-- Glow behind -->
        <div
          class="absolute inset-0 bg-aurora-purple blur-3xl opacity-30 animate-pulse rounded-full -z-10 transform translate-z-[-50px]">
        </div>

        <div id="disk"
          class="relative w-full h-full bg-cover bg-center rounded-full shadow-2xl border-4 border-white/10 z-10"
          [style.background-image]="'url(' + (track()?.cover || '') + ')'" [class.animate-spin-slow]="isPlaying()">
          <!-- Center Hole -->
          <div
            class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-16 h-16 bg-aurora-dark rounded-full border border-white/10 flex items-center justify-center">
            <div class="w-4 h-4 bg-aurora-blue rounded-full"></div>
          </div>
        </div>
      </div>

      <!-- Artist Info (Mobile Only) -->
      <div class="md:hidden mt-8 text-center text-white">
        <h1 class="text-3xl font-bold mb-2">{{ track()?.title || 'No Track Selected' }}</h1>
        <p class="text-aurora-blue/80">Premium Audio</p>
      </div>

      <!-- PWA Install Button (Mobile/Desktop) -->
      <button *ngIf="showInstallButton()" (click)="installApp()"
        class="mt-8 bg-white/10 hover:bg-white/20 text-white px-6 py-2 rounded-full backdrop-blur-md border border-white/10 transition-all transform hover:scale-105 flex items-center gap-2">
        <i class="fas fa-download"></i>
        <span>Install App</span>
      </button>
    </div>

    <!-- Right: Controls Section -->
    <div class="w-full max-w-md mx-auto">
      <app-glass-card className="w-full">

        <!-- Track Info (Desktop) -->
        <div class="hidden md:block mb-8">
          <h2 class="text-xs font-bold tracking-widest text-aurora-blue mb-2 uppercase">Now Playing</h2>
          <h1 class="text-4xl font-black text-white leading-tight mb-2 truncate">{{ track()?.title || 'Select a Song' }}
          </h1>
          <p class="text-white/60">Sonic Glass Experience</p>
        </div>

        <!-- Progress Bar -->
        <div class="mb-8">
          <div class="flex justify-between text-xs font-medium text-white/50 mb-2">
            <span>{{ formatTime(currentTime()) }}</span>
            <span>{{ formatTime(duration()) }}</span>
          </div>

          <div (click)="onSeek($event)"
            class="h-2 bg-white/10 rounded-full cursor-pointer relative overflow-hidden group">
            <!-- Glow on hover -->
            <div
              class="absolute inset-y-0 left-0 bg-aurora-purple/50 blur-sm w-full opacity-0 group-hover:opacity-100 transition-opacity">
            </div>

            <div class="h-full bg-gradient-to-r from-aurora-blue to-aurora-purple rounded-full relative"
              [style.width.%]="progress()">
              <!-- Handle -->
              <div
                class="absolute right-0 top-1/2 -translate-y-1/2 w-3 h-3 bg-white rounded-full shadow-lg scale-0 group-hover:scale-100 transition-transform">
              </div>
            </div>
          </div>
        </div>

        <!-- Controls -->
        <div class="flex flex-col gap-6">

          <!-- Volume & Interaction -->
          <div class="flex items-center justify-between px-4">
            <!-- Volume -->
            <div class="flex items-center gap-2 group w-1/3">
              <i class="fas fa-volume-down text-white/50 text-xs"></i>
              <input type="range"
                class="w-full h-1 bg-white/10 rounded-lg appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-3 [&::-webkit-slider-thumb]:h-3 [&::-webkit-slider-thumb]:bg-white [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:opacity-0 group-hover:[&::-webkit-slider-thumb]:opacity-100 transition-all"
                min="0" max="1" step="0.01" [value]="volume()" (input)="onVolumeChange($event)">
            </div>

            <!-- Favorite -->
            <button (click)="toggleFavorite()"
              class="text-white/30 hover:text-aurora-purple transition-colors transform hover:scale-110 active:scale-95"
              [class.text-aurora-purple]="isFavorite()" [class.text-red-500]="isFavorite()"> <!-- Use red or purple -->
              <i class="fas" [class.fa-heart]="isFavorite()" [class.fa-heart-broken]="!isFavorite() && false"
                [class.far]="!isFavorite()"></i> <!-- fa-heart solid vs regular -->
              <i class="text-xl" [class.fas]="isFavorite()" [class.far]="!isFavorite()" class="fa-heart"></i>
            </button>
          </div>

          <!-- Playback Controls -->
          <div class="flex items-center justify-between px-0">

            <!-- Shuffle -->
            <button (click)="audio.toggleShuffle()" [class.text-aurora-purple]="isShuffleOn()"
              [class.text-white-40]="!isShuffleOn()"
              class="hover:text-white transition-colors p-3 rounded-full hover:bg-white/5 relative group">
              <i class="fas fa-random text-lg"></i>
              <span *ngIf="isShuffleOn()"
                class="absolute -bottom-1 left-1/2 -translate-x-1/2 w-1 h-1 bg-aurora-purple rounded-full"></span>
            </button>

            <!-- Prev -->
            <button (click)="audio.prev()"
              class="text-white/70 hover:text-white transition-colors p-4 rounded-full hover:bg-white/5">
              <i class="fas fa-step-backward text-2xl"></i>
            </button>

            <!-- Play/Pause (Animated Morph) -->
            <button (click)="audio.toggle()"
              class="w-20 h-20 flex items-center justify-center rounded-full bg-gradient-to-tr from-aurora-blue to-aurora-purple text-white shadow-lg shadow-aurora-purple/30 hover:scale-110 active:scale-95 transition-all">
              <i class="fas text-3xl" [class.fa-play]="!isPlaying()" [class.fa-pause]="isPlaying()"></i>
            </button>

            <!-- Next -->
            <button (click)="audio.next()"
              class="text-white/70 hover:text-white transition-colors p-4 rounded-full hover:bg-white/5">
              <i class="fas fa-step-forward text-2xl"></i>
            </button>

            <!-- Repeat -->
            <button (click)="audio.toggleRepeat()" [class.text-aurora-purple]="repeatMode() !== RepeatMode.OFF"
              [class.text-white-40]="repeatMode() === RepeatMode.OFF"
              class="hover:text-white transition-colors p-3 rounded-full hover:bg-white/5 relative">
              <i class="fas fa-redo text-lg"></i>
              <span *ngIf="repeatMode() === RepeatMode.ONE"
                class="absolute top-[10px] right-[8px] text-[8px] font-bold bg-aurora-dark px-1 rounded-full border border-aurora-purple text-aurora-purple">1</span>
            </button>

          </div>
        </div>

      </app-glass-card>

      <!-- Playlist Details -->
      <div class="mt-6 text-center">
        <button (click)="isDrawerOpen.set(true)"
          class="text-white/40 hover:text-white text-sm font-light tracking-wide transition-colors group">
          VIEW PLAYLIST <i class="fas fa-chevron-up ml-1 group-hover:-translate-y-1 transition-transform"></i>
        </button>
      </div>

    </div>
  </div>
</div>